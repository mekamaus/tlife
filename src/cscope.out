cscope 15 $HOME/git/tlife/src               0000014569
	@block.c

1 
	~"block.h
"

3 cÚ¡ 
Block
 
	gBLOCK_EMPTY
 = 0;

	@block.h

1 #´agm¨
Úû


4 
	tBlock
;

6 cÚ¡ 
Block
 
BLOCK_EMPTY
;

	@cell.c

1 
	~"ûÎ.h
"

3 cÚ¡ 
	gCOLOR_INDEX
 = 7;

5 cÚ¡ 
C–l
 
	gEMPTY_CELL
 = {

11 cÚ¡ 
C–l
 
	gNEWLINE_CELL
 = {

17 cÚ¡ 
C–l
 
	gNULL_CELL
 = {

24 cÚ¡ 
Sh­e
 
	gPLAYER_HEAD
 = {{{0xEE, 0x82, 0xB6}}, {{0xEE, 0x82, 0xB4}}};

27 cÚ¡ 
Sh­e
 
	gPLAYER_BODY_FRONT
 = {{{0xE2, 0x96, 0x9C}}, {{0xE2, 0x96, 0x9B}}};

30 cÚ¡ 
Sh­e
 
	gPLAYER_BODY_BACK
 = {{{0xE2, 0x96, 0x9C}}, {{0xE2, 0x96, 0x9B}}};

33 cÚ¡ 
Sh­e
 
	gPLAYER_BODY_LEFT
 = {{{0xE2, 0x96, 0x9C}}, {{0xE2, 0x96, 0x8D}}};

36 cÚ¡ 
Sh­e
 
	gPLAYER_BODY_RIGHT
 = {{{0xE2, 0x96, 0x90}}, {{0xE2, 0x96, 0x9B}}};

39 cÚ¡ 
Sh­e
 
	gEMPTY_TARGET
 = {{{0xEE, 0x82, 0xB3}}, {{0xEE, 0x82, 0xB1}}};

42 cÚ¡ 
Sh­e
 
	gEMPTY_TARGET_LEFT
 = {{{0x20, 0x08, 0x20}}, {{0xEE, 0x82, 0xB3}}};

45 cÚ¡ 
Sh­e
 
	gEMPTY_TARGET_RIGHT
 = {{{0xEE, 0x82, 0xB1}}, {{0x20, 0x08, 0x20}}};

48 cÚ¡ 
Sh­e
 
	gBLOCK
 = {{{0xE2, 0x96, 0x88}}, {{0xE2, 0x96, 0x88}}};

51 cÚ¡ 
Sh­e
 
	gEMPTY
 = {{{0x20, 0x08, 0x20}}, {{0x20, 0x08, 0x20}}};

	@cell.h

1 #´agm¨
Úû


3 
	~"m­.h
"

4 
	~"sh­e.h
"

5 
	~<¡ršg.h
>

7 cÚ¡ 
COLOR_INDEX
;

9 
	sEsÿ³dCŞÜ
 {

10 
	md©a
[11];

11 } 
	tEsÿ³dCŞÜ
;

13 
	sC–l
 {

14 
Esÿ³dCŞÜ
 
	mfÜeground
;

15 
Esÿ³dCŞÜ
 
	mbackground
;

16 
Sh­e
 
	msh­e
;

17 } 
	tC–l
;

19 cÚ¡ 
C–l
 
EMPTY_CELL
;

20 cÚ¡ 
C–l
 
NEWLINE_CELL
;

21 cÚ¡ 
C–l
 
NULL_CELL
;

24 cÚ¡ 
Sh­e
 
PLAYER_HEAD
;

27 cÚ¡ 
Sh­e
 
PLAYER_BODY_FRONT
;

30 cÚ¡ 
Sh­e
 
PLAYER_BODY_BACK
;

33 cÚ¡ 
Sh­e
 
PLAYER_BODY_LEFT
;

36 cÚ¡ 
Sh­e
 
PLAYER_BODY_RIGHT
;

39 cÚ¡ 
Sh­e
 
EMPTY_TARGET
;

42 cÚ¡ 
Sh­e
 
EMPTY_TARGET_LEFT
;

45 cÚ¡ 
Sh­e
 
EMPTY_TARGET_RIGHT
;

48 cÚ¡ 
Sh­e
 
BLOCK
;

51 cÚ¡ 
Sh­e
 
EMPTY
;

54 cÚ¡ 
Sh­e
 *
g‘_rg‘_sh­e
(
dr
, 
dc
);

57 cÚ¡ 
Sh­e
 *
g‘_rg‘_sh­e_Ëá
(
dr
, 
dc
);

60 cÚ¡ 
Sh­e
 *
g‘_rg‘_sh­e_right
(
dr
, 
dc
);

	@cell_renderer.c

1 
	~"ûÎ_»nd””.h
"

3 
£t_fg_cŞÜ
(
C–l
 *
ûÎ
, 
CŞÜ
 
cŞÜ
);

4 
£t_bg_cŞÜ
(
C–l
 *
ûÎ
, 
CŞÜ
 
cŞÜ
);

5 cÚ¡ 
Sh­e
 *
g‘_rg‘_sh­e
(
dr
, 
dc
);

6 cÚ¡ 
Sh­e
 *
g‘_rg‘_sh­e_Ëá
(
dr
, 
dc
);

7 cÚ¡ 
Sh­e
 *
g‘_rg‘_sh­e_right
(
dr
, 
dc
);

9 
	$»nd”_ûÎ
(
M­
 
m­
, 
Dim
 
rows
, Dim 
cŞumns
, Dim 
ûÎ_r
, Dim 
ûÎ_c
,

10 
Pos
 
¶ay”_r
, Po 
¶ay”_c
, Po 
¶ay”_dr
, Po 
¶ay”_dc
,

11 
C–l
 *
ûÎ
) {

12 
em±y
 = 
	`is_m­_ûÎ_em±y
(
m­
, 
rows
, 
cŞumns
, 
ûÎ_r
, 
ûÎ_c
);

13 
šside
 = 
	`is_šside_m­
(
rows
, 
cŞumns
, 
ûÎ_r
, 
ûÎ_c
);

14 
rg‘_šside
 =

15 
	`is_šside_m­
(
rows
, 
cŞumns
, 
¶ay”_r
 + 
¶ay”_dr
, 
¶ay”_c
 + 
¶ay”_dc
);

17 
šside_bg_cŞÜ
 = 
DARK_GREEN
;

18 
outside_bg_cŞÜ
 = 
BLACK
;

20 
aùu®_bg_cŞÜ
 = 
šside
 ? 
šside_bg_cŞÜ
 : 
outside_bg_cŞÜ
;

22 ià(
ûÎ_r
 =ğ
¶ay”_r
 - 1 && 
ûÎ_c
 =ğ
¶ay”_c
) {

23 
	`£t_fg_cŞÜ
(
ûÎ
, 
LIGHT_OLIVE
);

24 
	`£t_bg_cŞÜ
(
ûÎ
, 
em±y
 ? 
aùu®_bg_cŞÜ
 : 
LIGHT_GRAY
);

25 
ûÎ
->
sh­e
 = 
PLAYER_HEAD
;

26 } ià(
ûÎ_r
 =ğ
¶ay”_r
 && 
ûÎ_c
 =ğ
¶ay”_c
) {

27 
	`£t_fg_cŞÜ
(
ûÎ
, 
PURPLE
);

28 
	`£t_bg_cŞÜ
(
ûÎ
, 
aùu®_bg_cŞÜ
);

29 
ûÎ
->
sh­e
 = 
¶ay”_dr
 > 0

30 ? 
PLAYER_BODY_FRONT


31 : 
¶ay”_dr
 < 0 ? 
PLAYER_BODY_BACK


32 : 
¶ay”_dc
 < 0 ? 
PLAYER_BODY_LEFT


33 : 
PLAYER_BODY_RIGHT
;

34 } ià(
ûÎ_r
 =ğ
¶ay”_r
 + 
¶ay”_dr
 && 
ûÎ_c
 =ğ
¶ay”_c
 + 
¶ay”_dc
) {

36 
	`£t_fg_cŞÜ
(
ûÎ
, 
rg‘_šside
 ? 
WHITE
 : 
RED
);

37 
	`£t_bg_cŞÜ
(
ûÎ
, 
em±y
 ? 
aùu®_bg_cŞÜ
 : 
LIGHT_GRAY
);

38 
ûÎ
->
sh­e
 = *
	`g‘_rg‘_sh­e
(
¶ay”_dr
, 
¶ay”_dc
);

39 } ià(
¶ay”_dr
 =ğ-1 && 
¶ay”_dc
 == 0 &&

40 
ûÎ_r
 =ğ
¶ay”_r
 + 
¶ay”_dr
 &&

41 
ûÎ_c
 =ğ
¶ay”_c
 + 
¶ay”_dc
 - 1) {

43 
	`£t_fg_cŞÜ
(
ûÎ
, 
rg‘_šside
 ? 
WHITE
 : 
RED
);

44 
	`£t_bg_cŞÜ
(
ûÎ
, 
em±y
 ? 
aùu®_bg_cŞÜ
 : 
LIGHT_GRAY
);

45 
ûÎ
->
sh­e
 = *
	`g‘_rg‘_sh­e_Ëá
(
¶ay”_dr
, 
¶ay”_dc
);

46 } ià(
¶ay”_dr
 =ğ-1 && 
¶ay”_dc
 == 0 &&

47 
ûÎ_r
 =ğ
¶ay”_r
 + 
¶ay”_dr
 &&

48 
ûÎ_c
 =ğ
¶ay”_c
 + 
¶ay”_dc
 + 1) {

50 
	`£t_fg_cŞÜ
(
ûÎ
, 
rg‘_šside
 ? 
WHITE
 : 
RED
);

51 
	`£t_bg_cŞÜ
(
ûÎ
, 
em±y
 ? 
aùu®_bg_cŞÜ
 : 
LIGHT_GRAY
);

52 
ûÎ
->
sh­e
 = *
	`g‘_rg‘_sh­e_right
(
¶ay”_dr
, 
¶ay”_dc
);

53 } ià(
em±y
) {

54 
	`£t_fg_cŞÜ
(
ûÎ
, 
LIGHT_GRAY
);

55 
	`£t_bg_cŞÜ
(
ûÎ
, 
aùu®_bg_cŞÜ
);

56 
ûÎ
->
sh­e
 = 
EMPTY
;

58 
	`£t_fg_cŞÜ
(
ûÎ
, 
LIGHT_GRAY
);

59 
	`£t_bg_cŞÜ
(
ûÎ
, 
aùu®_bg_cŞÜ
);

60 
ûÎ
->
sh­e
 = 
BLOCK
;

62 
	}
}

64 
	$£t_cŞÜ
(
Esÿ³dCŞÜ
 *
esÿ³d_cŞÜ
, 
CŞÜ
 
cŞÜ
) {

65 
cŞÜ_¡ršg
[3] = {};

66 
cŞÜ_¡ršg
[0] = '0' + 
cŞÜ
 / 100;

67 
cŞÜ_¡ršg
[1] = '0' + (
cŞÜ
 / 10) % 10;

68 
cŞÜ_¡ršg
[2] = '0' + 
cŞÜ
 % 10;

70 
	`memıy
(
esÿ³d_cŞÜ
->
d©a
 + 
COLOR_INDEX
, 
cŞÜ_¡ršg
, 3);

71 
	}
}

73 
	$£t_fg_cŞÜ
(
C–l
 *
ûÎ
, 
CŞÜ
 
cŞÜ
) {

74 
	`£t_cŞÜ
(&
ûÎ
->
fÜeground
, 
cŞÜ
);

75 
	}
}

77 
	$£t_bg_cŞÜ
(
C–l
 *
ûÎ
, 
CŞÜ
 
cŞÜ
) {

78 
	`£t_cŞÜ
(&
ûÎ
->
background
, 
cŞÜ
);

79 
	}
}

81 cÚ¡ 
Sh­e
 *
	$g‘_rg‘_sh­e
(
dr
, 
dc
è{  &
EMPTY_TARGET
; 
	}
}

83 cÚ¡ 
Sh­e
 *
	$g‘_rg‘_sh­e_Ëá
(
dr
, 
dc
) {

84  &
EMPTY_TARGET_LEFT
;

85 
	}
}

87 cÚ¡ 
Sh­e
 *
	$g‘_rg‘_sh­e_right
(
dr
, 
dc
) {

88  &
EMPTY_TARGET_RIGHT
;

89 
	}
}

	@cell_renderer.h

1 
	~"ûÎ.h
"

2 
	~"m­.h
"

3 
	~"sÿÏr.h
"

6 
»nd”_ûÎ
(
M­
 
m­
, 
Dim
 
rows
, Dim 
cŞumns
, Dim 
ûÎ_r
, Dim 
ûÎ_c
,

7 
Pos
 
¶ay”_r
, Po 
¶ay”_c
, Po 
¶ay”_dr
, Po 
¶ay”_dc
,

8 
C–l
 *
ûÎ
);

	@char.h

1 #´agm¨
Úû


3 
	sCh¬
 {

4 
	md©a
[3];

5 } 
	tCh¬
;

	@color.c

1 
	~"cŞÜ.h
"

3 cÚ¡ 
CŞÜ
 
	gBLACK
 = 0;

4 cÚ¡ 
CŞÜ
 
	gRED
 = 1;

5 cÚ¡ 
CŞÜ
 
	gDARK_GREEN
 = 22;

6 cÚ¡ 
CŞÜ
 
	gLIGHT_OLIVE
 = 136;

7 cÚ¡ 
CŞÜ
 
	gPURPLE
 = 165;

8 cÚ¡ 
CŞÜ
 
	gLIGHT_GRAY
 = 243;

9 cÚ¡ 
CŞÜ
 
	gWHITE
 = 255;

	@color.h

1 #´agm¨
Úû


3 
	tCŞÜ
;

5 cÚ¡ 
CŞÜ
 
BLACK
;

6 cÚ¡ 
CŞÜ
 
RED
;

7 cÚ¡ 
CŞÜ
 
DARK_GREEN
;

8 cÚ¡ 
CŞÜ
 
LIGHT_OLIVE
;

9 cÚ¡ 
CŞÜ
 
PURPLE
;

10 cÚ¡ 
CŞÜ
 
LIGHT_GRAY
;

11 cÚ¡ 
CŞÜ
 
WHITE
;

	@controls.c

1 
	~"cÚŒŞs.h
"

2 
	~<¡dio.h
>

3 
	~<¡dlib.h
>

5 cÚ¡ 
Key
 
	gCONTROLS_LEFT
 = 'h';

6 cÚ¡ 
Key
 
	gCONTROLS_DOWN
 = 'j';

7 cÚ¡ 
Key
 
	gCONTROLS_UP
 = 'k';

8 cÚ¡ 
Key
 
	gCONTROLS_RIGHT
 = 'l';

10 
	$¡¬t_cÚŒŞs
() {

12 
	}
}

14 
	$»adkey
() {

15 
FILE
 *
å
 = 
	`pİ’
("read -n 1 -r -s key;ƒcho $key", "r");

16 ià(
å
 =ğ
NULL
) {

17 
	`ex™
(1);

19 
c
 = 
	`fg‘c
(
å
);

20 
	`pşo£
(
å
);

22  
c
;

23 
	}
}

	@controls.h

1 #´agm¨
Úû


3 
	tKey
;

5 
¡¬t_cÚŒŞs
();

7 
»adkey
();

	@file.h

1 #´agm¨
Úû


3 *
	tF’ame
;

	@main.c

1 
	~"m­_io.h
"

2 
	~"sü“n.h
"

3 
	~"sü“n_»nd””.h
"

4 
	~<¡dio.h
>

5 
	~<¡dlib.h
>

6 
	~<sys/ioùl.h
>

7 
	~<uni¡d.h
>

9 cÚ¡ 
	gHIDE_CURSOR_COMMAND
[] = "tput civis";

11 
	$»size_wšdow
(*
rows
, *
cŞumns
) {

12 
wšsize
 
size
;

13 
	`ioùl
(
STDOUT_FILENO
, 
TIOCGWINSZ
, &
size
);

14 ià(
size
.
ws_row
 !ğ*
rows
 || size.
ws_cŞ
 / 2 !ğ*
cŞumns
) {

15 *
rows
 = 
size
.
ws_row
;

16 *
cŞumns
 = 
size
.
ws_cŞ
 / 2;

20 
	}
}

22 
	$maš
() {

23 
	`sy¡em
(
HIDE_CURSOR_COMMAND
);

25 
¶ay”_moved
 = 1;

26 
m­_chªged
 = 0;

28 
¶ay”_r
 = -1;

29 
¶ay”_c
 = 0;

30 
¶ay”_dr
 = 1;

31 
¶ay”_dc
 = 0;

33 
F’ame
 
¶ay”_fe
 = "/tmp/player";

34 
F’ame
 
m­_fe
 = "/tmp/map";

36 
	`»ad_¶ay”
(
¶ay”_fe
, &
¶ay”_r
, &
¶ay”_c
, &
¶ay”_dr
, &
¶ay”_dc
);

38 
rows
 = 0;

39 
cŞumns
 = 0;

40 
»sized
 = 
	`»size_wšdow
(&
rows
, &
cŞumns
);

42 
Sü“n
 
sü“n
 = 
NULL
;

44 cÚ¡ 
Dim
 
m­_rows
 = 20;

45 cÚ¡ 
Dim
 
m­_cŞumns
 = 20;

46 
m­
[
m­_rows
 * 
m­_cŞumns
] = {0};

48 
	`»ad_m­
(
m­_fe
, 
m­
, 
m­_rows
, 
m­_cŞumns
);

50 
	`¡¬t_cÚŒŞs
();

53 ià(
¶ay”_moved
 || 
m­_chªged
 || 
»sized
) {

54 
	`»size_sü“n
(&
sü“n
, 
rows
, 
cŞumns
);

56 
ûÁ”_r
 = 
rows
 / 2;

57 
ûÁ”_c
 = 
cŞumns
 / 2;

59 
off£t_r
 = 
ûÁ”_r
 - 
¶ay”_r
;

60 
off£t_c
 = 
ûÁ”_c
 - 
¶ay”_c
;

62 
	`»nd”_sü“n
(

64 
sü“n
, 
rows
, 
cŞumns
,

66 
m­
, 
m­_rows
, 
m­_cŞumns
,

68 
off£t_r
, 
off£t_c
,

70 
¶ay”_r
, 
¶ay”_c
, 
¶ay”_dr
, 
¶ay”_dc
);

72 
	`´štf
("\e[0;0H%s", (*)
sü“n
);

75 ià(
¶ay”_moved
) {

76 
	`wr™e_¶ay”
(
¶ay”_fe
, 
¶ay”_r
, 
¶ay”_c
, 
¶ay”_dr
, 
¶ay”_dc
);

79 ià(
m­_chªged
) {

80 
	`wr™e_m­
(
m­_fe
, 
m­
, 
m­_rows
, 
m­_cŞumns
);

83 
	`cÚŒŞ_¶ay”
(

85 
m­
, 
m­_rows
, 
m­_cŞumns
,

87 &
¶ay”_r
, &
¶ay”_c
, &
¶ay”_dr
, &
¶ay”_dc
,

89 &
¶ay”_moved
, &
m­_chªged
);

91 
»sized
 = 
	`»size_wšdow
(&
rows
, &
cŞumns
);

94 
	`ä“
(
sü“n
);

97 
	}
}

	@map.c

1 
	~"m­.h
"

3 
	$is_m­_ûÎ_em±y
(
M­
 
m­
, 
Dim
 
rows
, Dim 
cŞumns
, Dim 
r
, Dim 
c
) {

4  
r
 < 0 ||„ >ğ
rows
 || 
c
 < 0 || c >ğ
cŞumns
 || !
m­
[columns *„ + c];

5 
	}
}

7 
	$is_šside_m­
(
Dim
 
rows
, Dim 
cŞumns
, 
Pos
 
r
, Po 
c
) {

8  
r
 >ğ0 &&„ < 
rows
 && 
c
 >ğ0 && c < 
cŞumns
;

9 
	}
}

11 
Block
 
	$g‘_m­_block
(
M­
 
m­
, 
Dim
 
rows
, Dim 
cŞumns
, Dim 
r
, Dim 
c
) {

12 ià(
r
 < 0 ||„ >ğ
rows
 || 
c
 < 0 || c >ğ
cŞumns
) {

13  
BLOCK_EMPTY
;

16  
m­
[
cŞumns
 * 
r
 + 
c
];

17 
	}
}

19 
	$£t_m­_block
(
M­
 
m­
, 
Dim
 
rows
, Dim 
cŞumns
, Dim 
r
, Dim 
c
, 
Block
 
v®ue
) {

20 ià(
r
 < 0 ||„ >ğ
rows
 || 
c
 < 0 || c >ğ
cŞumns
) {

24 
m­
[
cŞumns
 * 
r
 + 
c
] = 
v®ue
;

25 
	}
}

	@map.h

1 #´agm¨
Úû


3 
	~"block.h
"

4 
	~"cŞÜ.h
"

5 
	~"fe.h
"

6 
	~"sÿÏr.h
"

7 
	~<¡dio.h
>

10 *
	tM­
;

14 
is_m­_ûÎ_em±y
(
M­
 
m­
, 
Dim
 
rows
, Dim 
cŞumns
, Dim 
r
, Dim 
c
);

18 
is_šside_m­
(
Dim
 
rows
, Dim 
cŞumns
, 
Pos
 
r
, Po 
c
);

21 
Block
 
g‘_m­_block
(
M­
 
m­
, 
Dim
 
rows
, Dim 
cŞumns
, Dim 
r
, Dim 
c
);

24 
£t_m­_block
(
M­
 
m­
, 
Dim
 
rows
, Dim 
cŞumns
, Dim 
r
, Dim 
c
, 
Block
 
v®ue
);

	@map_io.c

1 
	~"m­_io.h
"

3 
	$»ad_m­
(
F’ame
 
f’ame
, 
M­
 
m­
, 
Dim
 
rows
, Dim 
cŞumns
) {

4 ià(
	`acûss
(
f’ame
, 
F_OK
) == -1) {

8 
FILE
 *
f
 = 
	`fİ’
(
f’ame
, "rb+");

9 
	`ä—d
(
m­
, (
Block
), 2 * 
rows
 * 
cŞumns
, 
f
);

10 
	`fşo£
(
f
);

11 
	}
}

13 
	$wr™e_m­
(
F’ame
 
f’ame
, 
M­
 
m­
, 
Dim
 
rows
, Dim 
cŞumns
) {

14 
FILE
 *
f
 = 
	`fİ’
(
f’ame
, "wb+");

15 
	`fwr™e
(
m­
, (
Block
), 2 * 
rows
 * 
cŞumns
, 
f
);

16 
	`fşo£
(
f
);

17 
	}
}

	@map_io.h

1 #´agm¨
Úû


3 
	~"block.h
"

4 
	~"m­.h
"

5 
	~"sÿÏr.h
"

6 
	~<¡dio.h
>

7 
	~<uni¡d.h
>

10 
»ad_m­
(
F’ame
 
f’ame
, 
M­
 
m­
, 
Dim
 
rows
, Dim 
cŞumns
);

13 
wr™e_m­
(
F’ame
 
f’ame
, 
M­
 
m­
, 
Dim
 
rows
, Dim 
cŞumns
);

	@player.c

1 
	~"¶ay”.h
"

2 
	~"uni¡d.h
"

4 
	$»ad_¶ay”
(
F’ame
 
f’ame
, *
r
, *
c
, *
dr
, *
dc
) {

5 ià(
	`acûss
(
f’ame
, 
F_OK
) == -1) {

9 
FILE
 *
f
 = 
	`fİ’
(
f’ame
, "rb+");

10 
	`ä—d
(
r
, (), 1, 
f
);

11 
	`ä—d
(
c
, (), 1, 
f
);

12 
	`ä—d
(
dr
, (), 1, 
f
);

13 
	`ä—d
(
dc
, (), 1, 
f
);

14 
	`fşo£
(
f
);

15 
	}
}

17 
	$wr™e_¶ay”
(
F’ame
 
f’ame
, 
r
, 
c
, 
dr
, 
dc
) {

18 
FILE
 *
f
 = 
	`fİ’
(
f’ame
, "wb+");

19 
	`fwr™e
(&
r
, (), 1, 
f
);

20 
	`fwr™e
(&
c
, (), 1, 
f
);

21 
	`fwr™e
(&
dr
, (), 1, 
f
);

22 
	`fwr™e
(&
dc
, (), 1, 
f
);

23 
	`fşo£
(
f
);

24 
	}
}

26 
	$cÚŒŞ_¶ay”
(
M­
 
m­
, 
rows
, 
cŞumns
, *
r
, *
c
, *
dr
,

27 *
dc
, *
¶ay”_moved
, *
m­_chªged
) {

28 
key
 = 
	`»adkey
();

29 
rÙ©e_Úly
 = 0;

30 *
¶ay”_moved
 = 0;

31 *
m­_chªged
 = 0;

32 ià(
key
 == 'h') {

33 ià(*
dr
 !ğ0 || *
dc
 != -1) {

34 *
dr
 = 0;

35 *
dc
 = -1;

36 
rÙ©e_Úly
 = 1;

38 *
¶ay”_moved
 = 1;

39 } ià(
key
 == 'j') {

40 ià(*
dr
 !ğ1 || *
dc
 != 0) {

41 *
dr
 = 1;

42 *
dc
 = 0;

43 
rÙ©e_Úly
 = 1;

45 *
¶ay”_moved
 = 1;

46 } ià(
key
 == 'k') {

47 ià(*
dr
 !ğ-1 || *
dc
 != 0) {

48 *
dr
 = -1;

49 *
dc
 = 0;

50 
rÙ©e_Úly
 = 1;

52 *
¶ay”_moved
 = 1;

53 } ià(
key
 == 'l') {

54 ià(*
dr
 !ğ0 || *
dc
 != 1) {

55 *
dr
 = 0;

56 *
dc
 = 1;

57 
rÙ©e_Úly
 = 1;

59 *
¶ay”_moved
 = 1;

60 } ià(
key
 == 'x') {

61 
	`£t_m­_block
(
m­
, 
rows
, 
cŞumns
, *
r
 + *
dr
, *
c
 + *
dc
, 0);

62 *
m­_chªged
 = 1;

63 } ià(
key
 == 'a') {

64 
	`£t_m­_block
(
m­
, 
rows
, 
cŞumns
, *
r
 + *
dr
, *
c
 + *
dc
, 1);

65 *
m­_chªged
 = 1;

70 ià(*
¶ay”_moved
 && !
rÙ©e_Úly
 &&

71 
	`is_m­_ûÎ_em±y
(
m­
, 
rows
, 
cŞumns
, *
r
 + *
dr
, *
c
 + *
dc
)) {

72 *
r
 +ğ*
dr
;

73 *
c
 +ğ*
dc
;

75 
	}
}

	@player.h

1 #´agm¨
Úû


3 
	~"cÚŒŞs.h
"

4 
	~"m­.h
"

6 
»ad_¶ay”
(
F’ame
 
f’ame
, *
r
, *
c
, *
dr
, *
dc
);

8 
wr™e_¶ay”
(
F’ame
 
f’ame
, 
r
, 
c
, 
dr
, 
dc
);

10 
cÚŒŞ_¶ay”
(
M­
 
m­
, 
rows
, 
cŞumns
, *
r
, *
c
, *
dr
,

11 *
dc
, *
¶ay”_moved
, *
m­_chªged
);

	@scalar.h

1 #´agm¨
Úû


4 
	tDim
;

7 
	tPos
;

	@screen.c

1 
	~"sü“n.h
"

3 cÚ¡ 
	gCOLOR_LENGTH
 = 3;

4 cÚ¡ 
	gCOLORS_LENGTH
 = 22;

6 
Sü“n
 
	$ü—‹_sü“n
(
rows
, 
cŞumns
) {

7 
row_Ëngth
 = 
cŞumns
 + 1;

9 
Sü“n
 
sü“n
 = (Sü“n)
	`m®loc
((
C–l
è* 
row_Ëngth
 * 
rows
);

11 
i
 = 0; i < 
rows
; ++i) {

12 
row_¡¬t
 = 
row_Ëngth
 * 
i
;

13 
j
 = 0; j <ğ
row_Ëngth
; ++j) {

14 
sü“n
[
row_¡¬t
 + 
j
] = j < 
row_Ëngth
 - 1

15 ? 
EMPTY_CELL


16 : 
i
 < 
rows
 - 1 ? 
NEWLINE_CELL
 : 
NULL_CELL
;

20  
sü“n
;

21 
	}
}

23 
	$»size_sü“n
(
Sü“n
 *
sü“n
, 
rows
, 
cŞumns
) {

24 
	`ä“
(*
sü“n
);

25 *
sü“n
 = 
	`ü—‹_sü“n
(
rows
, 
cŞumns
);

26 
	}
}

	@screen.h

1 #´agm¨
Úû


3 
	~<¡dlib.h
>

4 
	~<¡ršg.h
>

6 
	~"ûÎ.h
"

7 
	~"ûÎ_»nd””.h
"

8 
	~"¶ay”.h
"

10 
C–l
 *
	tSü“n
;

12 cÚ¡ 
COLOR_LENGTH
;

13 cÚ¡ 
COLORS_LENGTH
;

15 
Sü“n
 
ü—‹_sü“n
(
rows
, 
cŞumns
);

17 
»size_sü“n
(
Sü“n
 *
sü“n
, 
rows
, 
cŞumns
);

	@screen_renderer.c

1 
	~"sü“n_»nd””.h
"

3 
	$»nd”_sü“n
(
Sü“n
 
sü“n
, 
Dim
 
sü“n_rows
, Dim 
sü“n_cŞumns
, 
M­
 
m­
,

4 
Dim
 
m­_rows
, Dim 
m­_cŞumns
, 
Pos
 
off£t_r
, Po 
off£t_c
,

5 
Pos
 
¶ay”_r
, Po 
¶ay”_c
, Po 
¶ay”_dr
, Po 
¶ay”_dc
) {

6 
sü“n_r
 = 0; sü“n_¸< 
sü“n_rows
; ++screen_r) {

7 
sü“n_c
 = 0; sü“n_ø< 
sü“n_cŞumns
; ++screen_c) {

8 
ûÎ_r
 = 
sü“n_r
 - 
off£t_r
;

9 
ûÎ_c
 = 
sü“n_c
 - 
off£t_c
;

11 
	`»nd”_ûÎ
(
m­
, 
m­_rows
, 
m­_cŞumns
, 
ûÎ_r
, 
ûÎ_c
, 
¶ay”_r
,

12 
¶ay”_c
, 
¶ay”_dr
, 
¶ay”_dc
,

13 
sü“n
 + (
sü“n_cŞumns
 + 1è* 
sü“n_r
 + 
sü“n_c
);

16 
	}
}

	@screen_renderer.h

1 #´agm¨
Úû


3 
	~"sü“n.h
"

5 
»nd”_sü“n
(
Sü“n
 
sü“n
, 
Dim
 
sü“n_rows
, Dim 
sü“n_cŞumns
, 
M­
 
m­
,

6 
Dim
 
m­_rows
, Dim 
m­_cŞumns
, 
Pos
 
off£t_r
, Po 
off£t_c
,

7 
Pos
 
¶ay”_r
, Po 
¶ay”_c
, Po 
¶ay”_dr
, Po 
¶ay”_dc
);

	@shape.h

1 #´agm¨
Úû


3 
	~"ch¬.h
"

5 
	sSh­e
 {

6 
Ch¬
 
	ma
;

7 
Ch¬
 
	mb
;

8 } 
	tSh­e
;

	@test.c

1 
	~<¡dio.h
>

2 
	~<¡dlib.h
>

3 
	~<sys/ioùl.h
>

4 
	~<uni¡d.h
>

6 
	$maš
() {

8 cÚ¡ 
BLOCK
[7] = "â–ˆâ–ˆ";

11 
i
 = 0; 
BLOCK
[i] != '\0'; ++i) {

12 
	`´štf
("%c\n", ()
BLOCK
[
i
]);

16 
	}
}

	@
1
.
0
26
247
block.c
block.h
cell.c
cell.h
cell_renderer.c
cell_renderer.h
char.h
color.c
color.h
controls.c
controls.h
file.h
main.c
map.c
map.h
map_io.c
map_io.h
player.c
player.h
scalar.h
screen.c
screen.h
screen_renderer.c
screen_renderer.h
shape.h
test.c
